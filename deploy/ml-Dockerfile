FROM python:3.9-slim

# Copy relevant codes
COPY app/ /usr/src/app/app/

WORKDIR /usr/src/app

ENV PYTHONPATH=/usr/src/app

# Print the current directory and its ls and show when I run docker compose
RUN ls -la

# Install Nginx
RUN apt-get update && \
    apt-get install -y nginx && \
    rm -rf /var/lib/apt/lists/*

# Copy the Nginx configuration file into the container
COPY nginx.conf /etc/nginx/nginx.conf

# Install dependencies
COPY deploy/ml-requirements.txt ./
RUN pip install -r ml-requirements.txt
# RUN pip install --no-cache-dir -r backend-requirements.txt

EXPOSE 5001

# Run Nginx and the application using a multi-command tool such as supervisord
COPY supervisord.conf /etc/supervisord.conf
CMD ["supervisord", "-c", "/etc/supervisord.conf"]

# Print the current directory and its ls and show when I run docker compose
CMD ["python", "app/services/ml_service/ml_service_app.py"]